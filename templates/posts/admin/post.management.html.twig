{% extends 'base.html.twig' %}

{% block title %} Admin posts {% endblock %}

{% block stylesheets %}
<style>
  :root {
    --bg-main: #f8fafc;
    --text-main: #0f172a;
    --text-muted: #64748b;
    --primary: #6366f1;
    --card-bg: #ffffff;
    --radius: 14px;
  }

  body {
    background: var(--bg-main);
    color: var(--text-main);
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI",
                 Roboto, Inter, Helvetica, Arial, sans-serif;
  }

  .container {
    width: 100%;
    padding: 3rem 1rem;
    display: flex;
    justify-content: center;
  }

  .container .wrapper {
    width: 100%;
    max-width: 1200px;
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 24px;
    align-items: start;
  }

  /* Intro block */
  .text-block {
    grid-column: 1 / -1;
    margin-bottom: 1.5rem;
  }

  .title {
    font-size: clamp(1.8rem, 3vw, 2.4rem);
    font-weight: 700;
    margin-bottom: .75rem;
    letter-spacing: -0.02em;
  }

  .desc {
    max-width: 900px;
    line-height: 1.7;
    color: var(--text-muted);
    font-size: 1rem;
  }

  /* Cards */
  .container .card {
    cursor: pointer;
    border: none;
    border-radius: var(--radius);
    overflow: hidden;
    background: var(--card-bg);
    box-shadow: 0 6px 20px rgba(15, 23, 42, 0.08);
    transition: transform .25s ease, box-shadow .25s ease;
    display: flex;
    flex-direction: column;
  }

  .container .card:hover {
    transform: translateY(-6px);
    box-shadow: 0 16px 40px rgba(15, 23, 42, 0.15);
  }

  .container .card img {
    width: 100%;
    height: 170px;
    object-fit: cover;
    background: #e5e7eb;
  }

  .card-body {
    display: flex;
    flex-direction: column;
    height: 100%;
    padding: 1rem 1.1rem 1.2rem;
  }

  .card-title {
    font-weight: 600;
    font-size: 1.05rem;
    margin-bottom: .4rem;
    color: var(--text-main);
  }

  .card-text {
    flex-grow: 1;
    color: var(--text-muted);
    font-size: .95rem;
    line-height: 1.5;
    overflow: hidden;
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
  }

  .card-actions {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: .9rem;
    font-size: .8rem;
  }

  .card-actions a {
    color: var(--primary);
    font-weight: 500;
    text-decoration: none;
    margin-right: .6rem;
    transition: opacity .2s ease;
  }

  .card-actions a:hover {
    opacity: .75;
    text-decoration: underline;
  }

  .card-actions small {
    color: var(--text-muted);
    font-size: .75rem;
  }

  /* Responsive tweaks */
  @media (max-width: 640px) {
    .container {
      padding: 2rem 1rem;
    }

    .desc {
      font-size: .95rem;
    }
  }
</style>
{% endblock %}



{% block body %}
<div class='container'>
    <div class= "wrapper">
        <div>
            <h1>Post Manager</h1>
            <a href="{{ path('page_post_add') }}">+ Add new</a>
        </div>
        <table class="table table-striped">
            <thead>
                <tr>
                    <th scope="col" class="iid-col">#</th>
                    <th scope="col" class="title-col">Title</th>
                    <th scope="col" class="content-col">Content</th>
                    <th scope="col" class="pub-col">Published</th>
                    <th scope="col" class="date-col create-date-col">createdAt</th>
                    <th scope"col" class="edit-col"></th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
                {% for post in posts %}
                    <tr>
                        <td scope="row">{{post.id}}</td>

                        <td class='title'>{{post.title}}</td>

                        <td class='content'>{{ (post.content | slice(0, 15)) | nlbr2 }}...</td>

                        <td class="publish-btn">
                            <form
                                method="post"
                                action="{{ path('posts_toggle_publish', {id: post.id}) }}"
                                onsubmit="return confirm('Are you sure?');"
                                style="display:inline"
                            >
                                <input type="hidden" name="_token" value="{{ csrf_token('publish' ~ post.id) }}">
                                <button class="btn btn-link p-0">{{ post.isPublished ? "Undo publish" : "Publish" }}</button>
                            </form>
                        </td>

                        <td class="create-date-txt">
                            {{ post.createdAt | date('d/m/Y H:i') }}
                        </td>

                        <td class="pub-date-txt">
                           <a href="{{ path('page_post_edit', {id: post.id }) }}">edit</a>
                        </td>

                        <td>
                            <form
                                method="post"
                                action="{{ path('post_delete', {id: post.id}) }}"
                                onsubmit="return confirm('Are you sure?');"
                                style="display:inline"
                            >
                                <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ post.id) }}">
                                <button class="btn btn-link p-0">delete</button>
                            </form>
                        </td>
                        
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}