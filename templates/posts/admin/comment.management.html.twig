{% extends 'base.html.twig' %}

{% block title %} Admin posts {% endblock %}


{% block stylesheets %}
<style>
  :root {
    --bg: #f8fafc;
    --card-bg: #ffffff;
    --border: #e5e7eb;
    --text-main: #0f172a;
    --text-muted: #64748b;
    --primary: #4f46e5;
    --success: #16a34a;
    --danger: #dc2626;
    --radius: 12px;
    --shadow-soft: 0 6px 20px rgba(15, 23, 42, 0.08);
    --shadow-strong: 0 14px 40px rgba(15, 23, 42, 0.15);
  }

  body {
    background: var(--bg);
    color: var(--text-main);
    font-family: Inter, -apple-system, BlinkMacSystemFont,
      "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
  }

  /* Wrapper */
  .wrapper {
    margin-top: 3rem;
    animation: fadeUp .6s ease both;
  }

  h4 {
    font-weight: 600;
    letter-spacing: -0.01em;
  }

  /* Table */
  .table {
    background: var(--card-bg);
    border-radius: var(--radius);
    overflow: hidden;
    box-shadow: var(--shadow-soft);
  }

  .table thead th {
    font-size: .75rem;
    text-transform: uppercase;
    letter-spacing: .06em;
    color: var(--text-muted);
    background: #f8fafc;
    border-bottom: 1px solid var(--border);
  }

  .table th,
  .table td {
    padding: .9rem 1.1rem;
    vertical-align: middle;
  }

  /* Rows */
  .table tbody tr {
    cursor: pointer;
    transition:
      background-color .25s ease,
      transform .2s ease;
  }

  .table tbody tr:hover {
    background-color: #f1f5f9;
    transform: translateX(2px);
  }

  /* User image */
  .user-img img {
    width: 42px;
    height: 42px;
    object-fit: cover;
    border-radius: 50%;
    border: 1px solid var(--border);
    transition: transform .25s ease, box-shadow .25s ease;
  }

  .table tbody tr:hover .user-img img {
    transform: scale(1.05);
    box-shadow: 0 4px 10px rgba(0,0,0,.15);
  }

  /* User name */
  .fw-semibold {
    font-weight: 500;
  }

  /* Comment content */
  .comment-content {
    max-width: 360px;
    white-space: normal;
    word-break: break-word;
    font-size: .9rem;
    color: #475569;
    line-height: 1.5;
  }

  /* Status buttons */
  .status-btn {
    font-size: .8rem;
  }

  .status-btn .btn-link {
    font-weight: 500;
    padding: 0;
    text-decoration: none;
    position: relative;
  }

  .status-btn .btn-link::after {
    content: "";
    position: absolute;
    left: 0;
    bottom: -2px;
    width: 0;
    height: 1px;
    background: currentColor;
    transition: width .25s ease;
  }

  .status-btn .btn-link:hover::after {
    width: 100%;
  }

  .status-btn .btn-link {
    color: var(--primary);
  }

  /* Subtle emphasis per action */
  .status-btn form[action*="approve"] .btn-link {
    color: var(--success);
  }

  .status-btn form[action*="desapprove"] .btn-link,
  .status-btn form[action*="disapprove"] .btn-link {
    color: var(--danger);
  }

  /* Animations */
  @keyframes fadeUp {
    from {
      opacity: 0;
      transform: translateY(15px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  /* Responsive */
  @media (max-width: 768px) {
    .comment-content {
      max-width: 220px;
      font-size: .85rem;
    }

    .table th,
    .table td {
      padding: .7rem .8rem;
    }
  }
</style>
{% endblock %}




{% block body %}
<div class="container">
    <div class="wrapper">

        <h4 class="mb-3">Comments moderation</h4>

        <div class="table-responsive">
            <table class="table table-striped align-middle">
                <thead class="table-light">
                    <tr>
                        <th scope="col" class="iid-col">#</th>
                        <th scope="col"></th>
                        <th scope="col">User</th>
                        <th scope="col">Content</th>
                        <th scope="col">Post</th>
                        <th scope="col" class="text-center">Status</th>
                    </tr>
                </thead>

                <tbody>
                    {% for comment in comments %}
                        <tr
                            onClick="window.location.href='{{ path('post_comment_management', { id: comment?.post?.id }) }}'"
                        >
                            <th scope="row">{{ comment.id }}</th>

                            <td class="user-img">
                                <img
                                    src="{{ comment.user?.profilePicture | default('https://upload.wikimedia.org/wikipedia/commons/a/ac/No_image_available.svg') }}"
                                    alt="user image"
                                />
                            </td>

                            <td class="fw-semibold">
                                {{ [ comment.user?.firstName, comment.user?.lastName ] | join(' ') }}
                            </td>

                            <td class="comment-content">
                                {{ comment.content }}
                            </td>
                            <td>{{ (comment.post?.title | slice(0, 9)) | nl2br }}</td>

                            <td class="status-btn text-center">
                                {% if comment.status == "valide" %}
                                    <form
                                        method="post"
                                        action="{{ path('admin_approve_comment', {id: comment.id}) }}"
                                        onsubmit="return confirm('Are you sure? This will suppress all the posts associated to it');"
                                        style="display:inline"
                                    >
                                        <input type="hidden" name="_token" value="{{ csrf_token('approve' ~ category.id) }}">
                                        <button class="btn btn-link p-0">approve</button>
                                    </form>
                                {% else %}
                                    <form
                                        method="post"
                                        action="{{ path('admin_desapprove_comment', {id: comment.id}) }}"
                                        onsubmit="return confirm('Are you sure? This will suppress all the posts associated to it');"
                                        style="display:inline"
                                    >
                                        <input type="hidden" name="_token" value="{{ csrf_token('disapprove' ~ category.id) }}">
                                        <button class="btn btn-link p-0">Disapprove</button>
                                    </form>
                                {% endif %}
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

    </div>
</div>
{% endblock %}
